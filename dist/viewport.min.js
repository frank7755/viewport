/**
 * @module viewport
 * @author nuintun
 * @license MIT
 * @version 0.0.1
 * @description A library for get a callback when any element becomes visible in a viewport (window or custom viewport)
 * @see https://github.com/nuintun/viewport
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define("viewport",["jquery"],t):e.Viewport=t(e.jQuery)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e["default"]:e;var t=Object.prototype.toString;function r(e,r){if("array"===(r=(r+"").toLowerCase())&&Array.isArray)return Array.isArray(e);var i=t.call(e).toLowerCase();switch(r){case"nan":return"[object number]"===i&&e!=e;default:return i==="[object "+r+"]"}}var i=Array.isArray||function(e){return r(e,"array")};function n(e){return r(e,"number")}function o(e){if(!e)return!1;var t=document.createElement("div");try{t.appendChild(e)}catch(r){return!1}return 1===e.nodeType}var s=0;function a(e,t){if(n(e)&&isFinite(e))t&&(e=Math.abs(e)),e=[e,e,e,e];else if(i(e)){for(var r,o=[],s=e.length,a=0;a<s&&o.length<4;a++)n(r=e[a])&&isFinite(r)&&o.push(t?Math.abs(r):r);switch(o.length){case 0:e=[0,0,0,0];break;case 1:e=[o[0],o[0],o[0],o[0]];break;case 2:e=[o[0],o[1],o[0],o[1]];break;case 3:e=[o[0],o[1],o[2],o[1]];break;default:e=o}}else e=[0,0,0,0];return e}function l(t,r){if(window!=window&&o(t))throw new Error("Viewport must be window or a HTMLElement");var i,n=this;n.events={},n.id=s++,n.viewport=e(t),n._viewport=e((i=t)===window?"CSS1Compat"===document.compatMode?document.documentElement:document.body:i),n._initOptions(r),n._findTarget(),n._init()}return l.prototype={_initOptions:function(t){var r=(t=e.extend({delay:150,target:null,threshold:0,skipHidden:!0,thresholdBorderReaching:0},t)).delay;r=n(r)&&isFinite(r)?Math.abs(r):150,t.delay=r,t.threshold=a(t.threshold),t.thresholdBorderReaching=a(t.thresholdBorderReaching,!0),this.options=t},_findTarget:function(){var t=this,i=t.options.target,n=t._viewport;i=r(i,"string")?n.find(i):o(i)&&e.contains(n[0],i)?e(i):i instanceof e?i.filter(function(){return e.contains(n[0],this)}):null,t.target=i},_filterTarget:function(t,r){var i=[],n=this,o=n.target;if(!(o instanceof e)||0===o.length)return i;var s=n.options,a=s.threshold,l=s.skipHidden,c=0,f=0,h=n.viewport;if(h[0]!==window){var d=h[0].getBoundingClientRect();c=d.top+(Math.round(parseFloat(h.css("border-top-width")))||0),f=d.left+(Math.round(parseFloat(h.css("border-left-width")))||0)}return o.each(function(e,n){var o=n.getBoundingClientRect();if(0===o.top&&0===o.bottom&&0===o.left&&0===o.right)l||i.push(n);else{var s=o.top-c,h=o.bottom-c,d=o.left-f,u=o.right-f;s-a[2]>=r||u+a[3]<=0||h+a[0]<=0||d-a[1]>=t||i.push(n)}}),i},_viewChange:function(e,t,r){var i=this,n=i.options,o=i.viewport,s=i._viewport,a=n.thresholdBorderReaching;if(o[0]===window||o.is(":visible")){var l=o.innerWidth(),c=o.innerHeight(),f=s[0].scrollWidth,h=s[0].scrollHeight,d={};return d.scrollTop=o.scrollTop(),d.scrollLeft=o.scrollLeft(),d.offsetY=d.scrollTop-t,d.offsetX=d.scrollLeft-r,d.emitter=e,d.type="viewchange",d.viewport=[l,c,f,h],d.target=i._filterTarget(l,c),d.top=d.scrollTop-a[0]<=0,d.right=l+d.scrollLeft+a[1]>=f,d.bottom=c+d.scrollTop+a[2]>=h,d.left=d.scrollLeft-a[3]<=0,i.emit(d.type,d),d}},_init:function(){var e,t,r=this,i=r.id,n=r.options,o=r.viewport,s=o.scrollTop(),a=o.scrollLeft(),l=".viewport-"+i;function c(e){var t=r._viewChange(e.type,s,a);t&&(s=t.scrollTop,a=t.scrollLeft)}n.delay?e=function(e){clearTimeout(t),t=setTimeout(function(){c(e)},n.delay)}:e=c;o.on("scroll"+l+" resize"+l,e),r._viewChange("init",s,a)},on:function(t,r){return this.events[t]=this.events[t]||e.Callbacks("memory stopOnFalse"),this.events[t].add(r),this},off:function(e,t){var r=this;switch(arguments.length){case 0:r.events={};break;case 1:delete r.events[e];break;default:r.events[e]&&r.events[e].remove(t)}return r},emit:function(t){var r=[].slice.call(arguments,1);return this.events[t]=this.events[t]||e.Callbacks("memory stopOnFalse"),this.events[t].fireWith(this,r),this},refresh:function(t){var i=this,n=i.viewport;return arguments.length&&r(t,"object")&&i._initOptions(e.extend(i.options,t)),i._findTarget(),i._viewChange("refresh",n.scrollTop(),n.scrollLeft()),i},destroy:function(){var e=this.viewport,t=".viewport-"+this.id;e.off("scroll"+t),e.off("resize"+t)}},l});
//# sourceMappingURL=viewport.js.map