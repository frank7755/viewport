/**
 * @module viewport
 * @author nuintun
 * @license MIT
 * @version 0.0.1
 * @description A library for get a callback when any element becomes visible in a viewport (window or custom viewport)
 * @see https://github.com/nuintun/viewport
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define("viewport",["jquery"],e):t.Viewport=e(t.jQuery)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t["default"]:t;var e=Object.prototype.toString;function i(t,i){if("array"===(i=(i+"").toLowerCase())&&Array.isArray)return Array.isArray(t);var r=e.call(t).toLowerCase();switch(i){case"nan":return"[object number]"===r&&t!=t;default:return r==="[object "+i+"]"}}var r=Array.isArray||function(t){return i(t,"array")};function n(t){return i(t,"number")}function o(t){if(!t)return!1;var e=document.createElement("div");try{e.appendChild(t)}catch(i){return!1}return 1===t.nodeType}var s=0;function a(t,e){if(n(t)&&isFinite(t))e&&(t=Math.abs(t)),t=[t,t,t,t];else if(r(t)){for(var i,o=[],s=t.length,a=0;a<s&&o.length<4;a++)n(i=t[a])&&isFinite(i)&&o.push(e?Math.abs(i):i);switch(o.length){case 0:t=[0,0,0,0];break;case 1:t=[o[0],o[0],o[0],o[0]];break;case 2:t=[o[0],o[1],o[0],o[1]];break;case 3:t=[o[0],o[1],o[2],o[1]];break;default:t=o}}else t=[0,0,0,0];return t}function h(e,i){if(window!=window&&o(e))throw new Error("Viewport must be window or a HTMLElement");this.events={},this.id=s++,this.viewport=t(e),this._viewport=t(function(t){return t===window?"CSS1Compat"===document.compatMode?document.documentElement:document.body:t}(e)),this._initOptions(i),this._findTarget(),this._init()}return h.prototype={_initOptions:function(e){var i=(e=t.extend({delay:150,target:null,threshold:0,skipHidden:!0,thresholdBorderReaching:0},e)).delay;i=n(i)&&isFinite(i)?Math.abs(i):150,e.delay=i,e.threshold=a(e.threshold),e.thresholdBorderReaching=a(e.thresholdBorderReaching,!0),this.options=e},_findTarget:function(){var e=this.options.target,r=this._viewport;e=i(e,"string")?r.find(e):o(e)&&t.contains(r[0],e)?t(e):e instanceof t?e.filter(function(){return t.contains(r[0],this)}):null,this.target=e},_filterTarget:function(e,i){var r=[],n=this.target;if(!(n instanceof t)||0===n.length)return r;var o=this.options,s=o.threshold,a=o.skipHidden,h=0,l=0,c=this.viewport;if(c[0]!==window){var f=c[0].getBoundingClientRect();h=f.top+(Math.round(parseFloat(c.css("border-top-width")))||0),l=f.left+(Math.round(parseFloat(c.css("border-left-width")))||0)}return n.each(function(t,n){var o=n.getBoundingClientRect();if(0===o.top&&0===o.bottom&&0===o.left&&0===o.right)a||r.push(n);else{var c=o.top-h,f=o.bottom-h,u=o.left-l,d=o.right-l;c-s[2]>=i||d+s[3]<=0||f+s[0]<=0||u-s[1]>=e||r.push(n)}}),r},_viewChange:function(t,e,i){var r=this.options,n=this.viewport,o=this._viewport,s=r.thresholdBorderReaching;if(n[0]===window||n.is(":visible")){var a=n.innerWidth(),h=n.innerHeight(),l=o[0].scrollWidth,c=o[0].scrollHeight,f={};return f.scrollTop=n.scrollTop(),f.scrollLeft=n.scrollLeft(),f.offsetY=f.scrollTop-e,f.offsetX=f.scrollLeft-i,f.emitter=t,f.type="viewchange",f.viewport=[a,h,l,c],f.target=this._filterTarget(a,h),f.top=f.scrollTop-s[0]<=0,f.right=a+f.scrollLeft+s[1]>=l,f.bottom=h+f.scrollTop+s[2]>=c,f.left=f.scrollLeft-s[3]<=0,this.emit(f.type,f),f}},_init:function(){var t,e,i=this,r=i.id,n=i.options,o=i.viewport,s=o.scrollTop(),a=o.scrollLeft(),h=".viewport-"+r;function l(t){var e=i._viewChange(t.type,s,a);e&&(s=e.scrollTop,a=e.scrollLeft)}n.delay?t=function(t){clearTimeout(e),e=setTimeout(function(){l(t)},n.delay)}:t=l;o.on("scroll"+h+" resize"+h,t),i._viewChange("init",s,a)},on:function(e,i){return this.events[e]=this.events[e]||t.Callbacks("memory stopOnFalse"),this.events[e].add(i),this},off:function(t,e){switch(arguments.length){case 0:this.events={};break;case 1:delete this.events[t];break;default:this.events[t]&&this.events[t].remove(e)}return this},emit:function(e){var i=[].slice.call(arguments,1);return this.events[e]=this.events[e]||t.Callbacks("memory stopOnFalse"),this.events[e].fireWith(this,i),this},refresh:function(e){var r=this.viewport;return arguments.length&&i(e,"object")&&this._initOptions(t.extend(this.options,e)),this._findTarget(),this._viewChange("refresh",r.scrollTop(),r.scrollLeft()),this},destroy:function(){var t=this.viewport,e=".viewport-"+this.id;t.off("scroll"+e),t.off("resize"+e)}},h});
//# sourceMappingURL=viewport.js.map