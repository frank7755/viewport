!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define("viewport",["jquery"],t):e.Viewport=t(e.jQuery)}(this,function(e){"use strict";function t(e,t){if(t=(t+"").toLowerCase(),"array"===t&&Array.isArray)return Array.isArray(e);var r=c.call(e).toLowerCase();switch(t){case"nan":return"[object number]"===r&&e!==e;default:return r==="[object "+t+"]"}}function r(e){return t(e,"string")}function n(e){return t(e,"array")}function o(e){return t(e,"number")}function i(e){if(!e)return!1;var t=document.createElement("div");try{t.appendChild(e)}catch(r){return!1}return 1===e.nodeType}function s(e,t){if(o(e)&&isFinite(e))t&&(e=Math.abs(e)),e=[e,e,e,e];else if(n(e)){for(var r,i=[],s=e.length,a=0;a<s&&i.length<4;a++)r=e[a],o(r)&&isFinite(r)&&i.push(t?Math.abs(r):r);switch(i.length){case 0:e=[0,0,0,0];break;case 1:e=[i[0],i[0],i[0],i[0]];break;case 2:e=[i[0],i[1],i[0],i[1]];break;case 3:e=[i[0],i[1],i[2],i[1]];break;default:e=i}}else e=[0,0,0,0];return e}function a(e){return e===window?"CSS1Compat"===document.compatMode?document.documentElement:document.body:e}function l(t,r){if(window!==window&&i(t))throw new Error("Viewport must be window or a HTMLElement");var n=this;n.events={},n.id=f++,n.viewport=e(t),n.__viewport=e(a(t)),n.__initOptions(r),n.__findTarget(),n.__init()}e="default"in e?e["default"]:e;var c=Object.prototype.toString,f=0;return l.prototype={__initOptions:function(t){t=e.extend({delay:150,target:null,threshold:0,skipHidden:!0,thresholdBorderReaching:0},t);var r=t.delay;r=o(r)&&isFinite(r)?Math.abs(r):150,t.delay=r,t.threshold=s(t.threshold),t.thresholdBorderReaching=s(t.thresholdBorderReaching,!0),this.options=t},__findTarget:function(){var t=this,n=t.options,o=n.target,s=t.__viewport;o=r(o)?s.find(o):i(o)&&e.contains(s[0],o)?e(o):o instanceof e?o.filter(function(){return e.contains(s[0],this)}):null,t.target=o},__filterTargetInViewport:function(t,r){var n=[],o=this,i=o.target;if(!(i instanceof e)||0===i.length)return n;var s=o.options,a=s.threshold,l=s.skipHidden,c=0,f=0,u=o.viewport;if(u[0]!==window){var d=u[0].getBoundingClientRect();c=d.top+(Math.round(parseFloat(u.css("border-top-width")))||0),f=d.left+(Math.round(parseFloat(u.css("border-left-width")))||0)}return i.each(function(e,o){var i=o.getBoundingClientRect();if(0==i.top&&0==i.bottom&&0==i.left&&0==i.right)l||n.push(o);else{var s=i.top-c,u=i.bottom-c,d=i.left-f,h=i.right-f;s-a[2]>=r||h+a[3]<=0||u+a[0]<=0||d-a[1]>=t||n.push(o)}}),n},__changeViewport:function(e,t,r){var n=this,o=n.options,i=n.viewport,s=n.__viewport,a=o.thresholdBorderReaching;if(i[0]===window||i.is(":visible")){var l=i.innerWidth(),c=i.innerHeight(),f=s[0].scrollWidth,u=s[0].scrollHeight,d={};return d.scrollTop=i.scrollTop(),d.scrollLeft=i.scrollLeft(),d.offsetY=d.scrollTop-t,d.offsetX=d.scrollLeft-r,d.emitter=e,d.type="viewchange",d.viewport=[l,c,f,u],d.target=n.__filterTargetInViewport(l,c),d.top=d.scrollTop-a[0]<=0,d.right=l+d.scrollLeft+a[1]>=f,d.bottom=c+d.scrollTop+a[2]>=u,d.left=d.scrollLeft-a[3]<=0,n.emit(d.type,d),d}},__init:function(){function e(e){var t=r.__changeViewport(e.type,s,a);t&&(s=t.scrollTop,a=t.scrollLeft)}var t,r=this,n=r.id,o=r.options,i=r.viewport,s=i.scrollTop(),a=i.scrollLeft(),l=".viewport-"+n;if(o.delay){var c;t=function(t){clearTimeout(c),c=setTimeout(function(){e(t)},o.delay)}}else t=e;i.on("scroll"+l+" resize"+l,t),r.__changeViewport("init",s,a)},on:function(t,r){var n=this;return n.events[t]=n.events[t]||e.Callbacks("memory stopOnFalse"),n.events[t].add(r),n},off:function(e,t){var r=this;switch(arguments.length){case 0:r.events={};break;case 1:delete r.events[e];break;default:r.events[e]&&r.events[e].remove(t)}return r},emit:function(t){var r=this,n=[].slice.call(arguments,1);return r.events[t]=r.events[t]||e.Callbacks("memory stopOnFalse"),this.events[t].fireWith(r,n),r},refresh:function(r){var n=this,o=n.viewport;return arguments.length&&t(r,"object")&&n.__initOptions(e.extend(n.options,r)),n.__findTarget(),n.__changeViewport("refresh",o.scrollTop(),o.scrollLeft()),n},destroy:function(){var e=this,t=e.viewport,r=".viewport-"+e.id;t.off("scroll"+r),t.off("resize"+r)}},l});
//# sourceMappingURL=viewport.js.map